---
title: "simulation"
author: "Richard"
date: "4/11/2022"
output: html_document
---

```{r}
library(tidyverse)
```


```{r}

# function that generates random ticket based on numbers and megaball vectors
random_ticket = function(numbers,megaball){
  ticket = sample(numbers,5,replace=FALSE)
  ball = sample(megaball,1,replace=FALSE)
  return(list('numbers' = ticket, 'megaball' = ball))
}
  

# function that gives cost of ticket based on multiplier
ticket_cost = function(multiplier=FALSE){
  cost = 2
  multi = 1
  if (multiplier==TRUE){
    cost = cost + 1
    multi = sample(2:5,1)
  }
  return(list('cost' = cost,'multiplier' = multi))
}


# function that compares ticket to winning numbers
number_matched = function(ticket, win_nums){
  megaball = 0
  matched = 0
  if (ticket$megaball == win_nums$megaball){megaball=1}
  for (num in ticket$numbers){
    for (target in win_nums$numbers){
      if (num == target){
        matched = matched + 1
      }
    }
  }
  return(list('match'= matched,'megaball'= megaball))
}


winnings = function(num_match, mega_match){
  if (mega_match == 1){
    if(num_match == 0){
      return (2)
    }
    else if (num_match == 1){
      return (4)
    }
    else if (num_match == 2){
      return (10)
    }
    else if (num_match == 3){
      return (200)
    }
    else if (num_match == 4){
      return (10000)
    }
    else{
      return(10000000)  
    }
  }
  else{
    if(num_match < 3){
      return (0)
    }
    else if(num_match == 3){
      return(10)
    }
    else if(num_match == 4){
      return (500)
    }
    else{
      return (1000000)
    }
  }
}

```


```{r}
lucky_nums = function(numbers,megaballs,multi = FALSE){
  ticket = random_ticket(numbers,megaballs)
  ticket_cost = ticket_cost(multiplier = multi)
  return(c(ticket,ticket_cost))
}


winning_nums = function(){
  return (lucky_nums(1:70,1:25,multi = TRUE))
}

```

Base case: Same number

```{r}
same_ticket = function(trials,m=FALSE){
  nums = 0
  megas = 0
  cost = 0
  win = c()
  multiplier = 1
  ticket = lucky_nums(1:70,1:25,multi=m)
  for (i in 1:trials){
    winning_numbers = winning_nums()
    if (m==TRUE){
      if (winning_numbers$multiplier == ticket$multiplier){
        multiplier = ticket$multiplier
      }else{multiplier = 1}
    }
    match = number_matched(ticket,winning_numbers)
    nums = nums + match$match
    megas = megas + match$megaball
    cost = cost + ticket$cost
    win = c(win,(winnings(match$match,match$megaball)*multiplier)-ticket$cost)
  }
  return(list('avg_nums' = nums/trials, 'avg_megas' = megas/trials, 'cost' = cost, 'winnings' = win))
}
```

Using a different(random) ticket each time the lottery is pulled

```{r}
diff_ticket = function(trials,m=FALSE){
  nums = 0
  megas = 0
  cost = 0
  win = c()
  multiplier = 1
  for (i in 1:trials){
    ticket = lucky_nums(1:70,1:25,multi=m)
    winning_numbers = winning_nums()
    if (m==TRUE){
      if (winning_numbers$multiplier == ticket$multiplier){
        multiplier = ticket$multiplier
      }else{multiplier = 1}
    }
    match = number_matched(ticket,winning_numbers)
    nums = nums + match$match
    megas = megas + match$megaball
    cost = cost + ticket$cost
    win = c(win,(winnings(match$match,match$megaball)*multiplier)-ticket$cost)
  }
  return(list('avg_nums' = nums/trials, 'avg_megas' = megas/trials, 'cost' = cost, 'winnings' = win))
}
```

win = total winnings - total cost

```{r}
base_case = same_ticket(10000,m=FALSE)
```


Multiplier vs No Multiplier

Comparing average ticket winnings between base_case and with multiplier, we see that there is a significant difference in winnings (p-value < 0.05). We reject the null hypothesis and find out that using the multiplier is worse than no multiplier (losses are larger)

```{r}
with_multi = same_ticket(10000, m=TRUE)

multi_test = t.test(base_case$winnings, with_multi$winnings, alternative = c('two.sided'))
multi_test
```

Comparing base case to choosing random tickets each lottery, we see that the P value is greater than 0.05 so we cannot reject the null hypothesis. Both scenarios yield the same results

```{r}
with_random = diff_ticket(10000,m= FALSE)
with_random$winnings%>%sum()

random_test = t.test(base_case$winnings, with_random$winnings, alternative = c('two.sided'))
random_test
```

# historical winning numbers from ny.gov resource

```{r}
megaMillionsDataURL <- "https://data.ny.gov/resource/5xaw-6ayf.csv"
megaMillionsWinningNumbers <- read.csv(megaMillionsDataURL)
megaMillionsWinningNumbers%>%head()
```

```{r}
winningNumberOccurrence = function(winning_tickets){
  winning_numbers = c()
  for (ticket in winning_tickets){
    winning_numbers = c(winning_numbers,str_split(ticket, pattern = ' ')[[1]])
  }
  number_counts = data.frame(numbers = winning_numbers)%>%
    group_by(numbers)%>%
    summarize(count = n())%>%
    arrange(-count)
    
  return(number_counts)
}

megaballOccurence = function(megaballs){
  number_counts = data.frame(numbers = megaballs)%>%
    group_by(numbers)%>%
    summarize(count = n())%>%
    arrange(-count)
  return(number_counts)
}

```


```{r}

number_counts = winningNumberOccurrence(megaMillionsWinningNumbers$winning_numbers)
megaball_counts = megaballOccurence(megaMillionsWinningNumbers$mega_ball)

hot_numbers = number_counts%>%filter(count >= mean(count))
hot_megaballs = megaball_counts%>%filter(count >= mean(count))

cold_numbers = number_counts%>%filter(count < mean(count))
cold_megaballs = megaball_counts%>%filter(count < mean(count))

```

Hot Hand Fallacy: Numbers that were more successful in the past are more likely to be successful in the future

```{r}
fallacy_cases = function(trials,n_choices,mb_choices,m=FALSE){
  nums = 0
  megas = 0
  cost = 0
  win = c()
  multiplier = 1
  ticket = lucky_nums(n_choices,mb_choices,multi=m)
  for (i in 1:trials){
    winning_numbers = winning_nums()
    if (m==TRUE){
      if (winning_numbers$multiplier == ticket$multiplier){
        multiplier = ticket$multiplier
      }else{multiplier = 1}
    }
    match = number_matched(ticket,winning_numbers)
    nums = nums + match$match
    megas = megas + match$megaball
    cost = cost + ticket$cost
    win = c(win,(winnings(match$match,match$megaball)*multiplier)-ticket$cost)
  }
  return(list('avg_nums' = nums/trials, 'avg_megas' = megas/trials, 'cost' = cost, 'winnings' = win))
}

hot_hand = fallacy_cases(10000,hot_numbers$numbers,hot_megaballs$numbers, m =FALSE)
hot_hand_test = t.test(base_case$winnings, hot_hand$winnings, alternative = c('two.sided'))
hot_hand_test
```

Gamblers Fallacy: Belief that occurances that were less likely to happen in the past are more likely to happen in the future

```{r}
gambler_fallacy = fallacy_cases(10000,cold_numbers$numbers,cold_megaballs$numbers,m=FALSE)
gambler_fallacy_test = t.test(base_case$winnings, gambler_fallacy$winnings, alternative = c('two.sided'))
gambler_fallacy_test
```

We are unable to reject the null hypothesis for both gamblers fallacy and hot hand fallacy as the they fall within the expected values of the base case

